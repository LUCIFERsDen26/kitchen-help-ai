<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingredients Input</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">
	<div class="container mt-5 w-50 ">
		<h1 class="text-center mb-4">Searh by Ingredients</h1>

		<!-- Form to collect ingredients -->
		<form id="ingredients-form" method="POST">
			<div id="ingredients-container" class="mb-4">
				<!-- Ingredient Input Group Template -->
				<div class="input-group mb-2">
					<input type="text" name="ingredients[]" class="form-control" placeholder="Enter ingredient" required>
					<!-- <button type="button" class="btn btn-danger remove-btn">Remove</button> -->
				</div>
			</div>

			<div class="container d-flex justify-content-center gap-4">
				<!-- Button to add more ingredients -->
				<button type="button" id="add-ingredient-btn" class="btn btn-secondary ">Add Another Ingredient</button>

				<!-- Submit button -->
				<button type="submit" class="btn btn-primary">find my recipe!</button>
			</div>
		</form>
	</div>

	<div class="container mt-3">
		{% if recipes %}
		<div class="container text-center mb-3">
			{% for ingredient in ingredients %}
				{{ ingredient }},
			{% endfor %}
		</div>
				<div class="card text-center pb-2">
					<div class="card-header">
						<ul class="nav nav-tabs card-header-tabs">
							{% for recipe in recipes %}
							<li class="nav-item">
								<a class="nav-link {% if loop.index == 1 %}active{% endif %}"
								   id="tabbtn_{{ loop.index }}"
								   href="#"
								   onclick="showTab({{ loop.index }});">
									Recipe {{ loop.index }}
								</a>
							</li>
							{% endfor %}
						</ul>
					</div>
	
					{% for recipe in recipes  %}
					<div id="tab{{ loop.index }}" style="{% if loop.index != 1 %}display: none;{% endif %}">
						<div class="card-body" align="left">
							<h5 class="card-title" align="center">
								{{ recipe.recipe_title }}
							</h5>
							<h6>Ingredients:</h6>
							<p class="card-text">{{ recipe.recipe_ingredients }}</p>
							<h6>Recipe:</h6>
							<p>{{ recipe.recipe_steps }}</p>
						</div>
					</div>
					{% endfor %}
				</div>
		{% endif %}
	</div>
	

    <script>
        document.getElementById('add-ingredient-btn').addEventListener('click', function() {
		const container = document.getElementById('ingredients-container');

		// Get all current input fields
		const textInputs = document.getElementsByName("ingredients[]");
		let hasEmptyField = false;

		// Validate all existing input fields
		textInputs.forEach(input => {
			if (input.value.trim() === "") {
				input.style.border = "1px solid red";
				hasEmptyField = true;
			} else {
				input.style.border = "";
			}
		});

		if (hasEmptyField) {
			alert("Please fill in all ingredient fields before adding a new one.");
			return;
		}

		// Create a new input group if validation passes
		const newIngredientGroup = document.createElement('div');
		newIngredientGroup.className = 'input-group mb-2';

		// Add a remove button only if it's not the first input
		newIngredientGroup.innerHTML = `
			<input type="text" name="ingredients[]" class="form-control" placeholder="Enter ingredient" required>
			${textInputs.length > 0 ? '<button type="button" class="btn btn-danger remove-btn">Remove</button>' : ''}
		`;

		container.appendChild(newIngredientGroup);

		// Attach event listener to the new remove button
		const removeBtn = newIngredientGroup.querySelector('.remove-btn');
		if (removeBtn) {
			removeBtn.addEventListener('click', function() {
				newIngredientGroup.remove();
			});
		}
	});

	// Event delegation for dynamically added remove buttons
	document.getElementById('ingredients-container').addEventListener('click', function(e) {
		if (e.target.classList.contains('remove-btn')) {
			e.target.parentElement.remove();
		}
	});
    </script>
	<script>
		function showTab(tabIndex) {

			const currentLink = document.querySelector(".nav-link.active");
			currentLinkId = currentLink.id.split("_")[1];
			if (currentLink) currentLink.classList.remove("active");
			const newLink = document.getElementById("tabbtn_" + tabIndex);
			newLink.classList.add("active");

			const currentTab = document.getElementById(
				"tab" + currentLinkId
			);
			currentTab.style.display = "none";
			const newTab = document.getElementById("tab" + tabIndex);
			newTab.style.display = "block";
			createRadarChart(tabIndex);
		}
	</script>

</body>
</html>
