{% extends "header.html" %}
{% block content %}
<div class="full-screen-section" id="first-section">
<div class="main-demo mx-auto">
    <div class="demo-title">
        <p class="p-2 m-0">Let's Start</p>
    </div>
    <br>
    <div class="pt-3 px-3">
        <ul class="nav nav-pills main-nav-selection m-auto" id="pills-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link main-nav nav-item-left active" id="tab-one" data-toggle="pill" href="#one" role="tab" aria-selected="true">Text Input</a>
            </li>
            <li class="nav-item">
                <a class="nav-link main-nav nav-item-center" id="tab-two" data-toggle="pill" href="#two" role="tab" aria-selected="false">Image Text</a>
            </li>
            <li class="nav-item">
                <a class="nav-link main-nav nav-item-right" id="tab-three" data-toggle="pill" href="#three" role="tab" aria-selected="false">Recipes</a>
            </li>
        </ul>
    </div>

    <div class="tab-content pb-3 px-3">
        <!-- Text Input Tab -->
        <div aria-labelledby="tab-one" class="text-center tab-pane fade show active" role="tabpanel" id="one">
            <div class="input-group demo-input my-4">
                <input type="text" id="demo-input" class="form-control query-input" placeholder="Enter some text.">
            </div>
            <button type="button" id="submit" class="m-3 btn btn-success">Get Recipe</button>
        </div>

        <div aria-labelledby="tab-two" class="tab-pane fade" id="two" role="tabpanel">
            <div>
                <!-- Form to upload the image -->
                <form id="image-upload-form" action="/" method="POST" enctype="multipart/form-data">
                    <div class="custom-file file">
                        <input 
                            type="file" 
                            class="custom-file-input" 
                            id="file" 
                            accept="image/png,image/jpeg" 
                            name="imagefile" 
                            required>
                        <label class="custom-file-label" for="file">Upload an image</label>
                    </div>
                    <!-- Submit button -->
                    <button type="submit" id="submit-image" class="btn btn-success m-3">Get Recipe</button>
                </form>
            </div>
        </div>
        
        

        <!-- Recipes Tab -->
        <div aria-labelledby="tab-three" class="text-center tab-pane fade" role="tabpanel" id="three">
            <div class="input-group demo-input my-4">
                <input type="text" id="demo-input-recipe" class="form-control query-input" placeholder="Enter a dish name.">
            </div>
            <button type="button" id="submit-recipe" class="btn btn-success m-3">Get Recipe</button>
        </div>
    </div>
</div>
</div>
<div id="info" class="col-md-8" style="display: none;"></div>
<div id="loading" style="display: none;" class="col-md-8">
    <div class="loader">
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
        <h4>Loading</h4>
        <h5>Kindly wait for a few seconds</h5>
    </div>
</div>


  {% block home %}{% endblock %}

  {% endblock %}
  <script>
document.getElementById('submit-image').addEventListener('click', function () {
    const fileInput = document.getElementById('file');
    const file = fileInput.files[0];
    if (!file) {
        alert('Please select an image file!');
        return;
    }

    const formData = new FormData();
    formData.append('imagefile', file);

    // Show loading indicator
    document.getElementById('loading').style.display = 'block';
    document.getElementById('info').style.display = 'none';

    fetch('/', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        // Hide loading indicator
        document.getElementById('loading').style.display = 'none';
        document.getElementById('info').style.display = 'block';

        // Dynamically build the content
        const infoDiv = document.getElementById('info');
        let htmlContent = `
            <div class="card text-center pb-2">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">`;

        // Add tabs dynamically
        data.title.forEach((title, i) => {
            if (title !== "Not a valid recipe!") {
                htmlContent += `
                    <li class="nav-item">
                        <a class="nav-link ${i === 0 ? 'active' : ''}" id="tabbtn${i + 1}" href="#" onclick="showTab(${i + 1})">
                            Recipe ${i + 1}
                        </a>
                    </li>`;
            }
        });

        htmlContent += `
                    </ul>
                </div>`;

        // Add recipe content dynamically
        data.title.forEach((title, i) => {
            if (title !== "Not a valid recipe!") {
                htmlContent += `
                    <div id="tab${i + 1}" style="${i !== 0 ? 'display: none;' : ''}">
                        <div class="card-body" align="left" id="result">
                            <h5 class="card-title" align="center">${title}</h5>
                            <br />
                            <h6>Ingredients:</h6>
                            <p class="card-text">${data.ingredients[i].join(', ')}</p>
                            <br />
                            <h6>Recipe:</h6>
                            <ol class="pl-3">
                                ${data.recipe[i].map(step => `<li class="card-text">${step}</li>`).join('')}
                            </ol>
                            <br />
                        </div>
                    </div>`;
            }
        });

        htmlContent += `
            </div>`;

        // Inject the HTML into the info div
        infoDiv.innerHTML = htmlContent;
    })
    .catch(error => {
        document.getElementById('loading').style.display = 'none';
        alert('An error occurred: ' + error);
    });
});

// Helper function to show the corresponding tab
function showTab(index) {
    const tabs = document.querySelectorAll('[id^="tab"]');
    tabs.forEach(tab => tab.style.display = 'none');
    document.getElementById(`tab${index}`).style.display = 'block';

    const tabLinks = document.querySelectorAll('[id^="tabbtn"]');
    tabLinks.forEach(link => link.classList.remove('active'));
    document.getElementById(`tabbtn${index}`).classList.add('active');
}

</script>

