{% extends "layout.html" %} {% block search %}
<section class="main-section cards-section text-center snipcss-vjEvd">
  <div class="full-screen-section-2" id="first-section">
    <div class="container mt-5" id="output-container">
      <img
        src="{{ img }}"
        alt="Uploaded Food Image"
        class="img-fluid"
        style="max-height: 300px; margin-bottom: 20px"
      />
      <div class="card text-center pb-2">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <a
                class="nav-link active"
                id="tabbtn1"
                onclick="javascript:myFunctab1()"
                >Recipe 1</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tabbtn2" onclick="javascript:myFunctab2()"
                >Recipe 2</a
              >
            </li>
          </ul>
        </div>

        <div id="tab1">
          <div class="card-body" align="left" id="result">
            {% if title[0] != "Not a valid recipe!" %}
            <h5 class="card-title" align="center">{{title[0]}}</h5>
            <br />
            <h6>Ingredients :</h6>
            <p class="card-text">{{', '.join(ingredients[0])}}</p>
            <br />
            <h6>Recipe :</h6>
            <ol class="pl-3">
              {% for i in recipe[0] %}
              <li class="card-text">{{i}}</li>
              {% endfor %}
            </ol>
            {% else %}
            <h5 class="card-title" align="center">{{title[0]}}</h5>
            <br />
            <h6 class="card-text">{{recipe[0]}}</h6>
            {% endif %}

            <div class="my-3" id="recipe-nutrients">
              <h6>Nutrient Values:</h6>
              <div class="container">
                {% set nutrients = nutrients_data[0] %}
                <div class="row">
                  {% if nutrients.nutrients is not mapping or nutrients.Error or
                  nutrients == [] %}
                  <div class="col-12">
                    <p class="text-danger">
                      Oops, something went wrong, so no nutrients.
                    </p>
                  </div>
                  {% else %} {% set nutrientsDataTable = nutrients.nutrients %}
                  <div class="col-md-6 d-flex justify-content-center">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Nutrient</th>
                          <th>Value</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for nutrient, value in nutrientsDataTable.items() %}
                        {% if nutrient != "Food Name" %}
                        <tr>
                          <td>{{ nutrient }}</td>
                          <td>{{ value }}</td>
                        </tr>
                        {% endif %} {% endfor %}
                      </tbody>
                    </table>
                  </div>

                  <div
                    class="col-md-6 d-flex justify-content-center align-items-center"
                  >
                    <div style="height: 100%; width: 100%">
                      <canvas
                        class="radar-chart"
                        id="nutrientRadarChart_1"
                        style="height: 100%; width: 100%"
                      ></canvas>
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            <br />
            <p class="card-text">
              <small class="text-muted">Check both the Recipes</small>
            </p>
          </div>
        </div>

        <div id="tab2" style="display: none">
          <div class="card-body" align="left" id="result">
            {% if title[1] != "Not a valid recipe!" %}
            <h5 class="card-title" align="center">{{title[1]}}</h5>
            <br />
            <h6>Ingredients :</h6>
            <p class="card-text">{{', '.join(ingredients[1])}}</p>
            <br />
            <h6>Recipe :</h6>
            <ol class="pl-3">
              {% for i in recipe[1] %}
              <li class="card-text">{{i}}</li>
              {% endfor %}
            </ol>
            {% else %}
            <h5 class="card-title" align="center">{{title[1]}}</h5>
            <br />
            <h6 class="card-text">{{recipe[1]}}</h6>
            {% endif %}

            <div class="my-3" id="recipe-nutrients">
              <h6>Nutrient Values:</h6>
              <div class="container">
                {% set nutrients = nutrients_data[1] %}
                <div class="row">
                  {% if nutrients.nutrients is not mapping or nutrients.Error or
                  nutrients == [] %}
                  <div class="col-12">
                    <p class="text-danger">
                      Oops, something went wrong, so no nutrients.
                    </p>
                  </div>
                  {% else %} {% set nutrientsDataTable = nutrients.nutrients %}
                  <div class="col-md-6 d-flex justify-content-center">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>Nutrient</th>
                          <th>Value</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for nutrient, value in nutrientsDataTable.items() %}
                        {% if nutrient != "Food Name" %}
                        <tr>
                          <td>{{ nutrient }}</td>
                          <td>{{ value }}</td>
                        </tr>
                        {% endif %} {% endfor %}
                      </tbody>
                    </table>
                  </div>

                  <div
                    class="col-md-6 d-flex justify-content-center align-items-center"
                  >
                    <div style="height: 100%; width: 100%">
                      <canvas
                        class="radar-chart"
                        id="nutrientRadarChart_2"
                        style="height: 100%; width: 100%"
                      ></canvas>
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const nutrientsData = {{ nutrients_data | tojson }};
  let currentTab = 1;

  function myFunctab1() {
      document.getElementById("tab2").style.display = "none";
      document.getElementById("tab1").style.display = "block";
      document.getElementById("tabbtn2").className = "nav-link";
      document.getElementById("tabbtn1").className = "nav-link active";
      currentTab = 1;
      setTimeout(() => createRadarChart(currentTab), 100);
  }

  function myFunctab2() {
      document.getElementById("tab1").style.display = "none";
      document.getElementById("tab2").style.display = "block";
      document.getElementById("tabbtn1").className = "nav-link";
      document.getElementById("tabbtn2").className = "nav-link active";
      currentTab = 2;
      setTimeout(() => createRadarChart(currentTab), 100);
  }

  function createRadarChart(tabIndex) {
      const tabNutrientsData = nutrientsData[tabIndex - 1].nutrients;
      const nutrientLabels = ['Calories', 'Cholesterol', 'Dietary Fiber', 'Phosphorus', 'Potassium', 'Protein', 'Saturated Fat', 'Sodium', 'Sugars'];
      const nutrientValues = nutrientLabels.map(label => tabNutrientsData[label] || 0);

      const ctx = document.getElementById('nutrientRadarChart_' + tabIndex).getContext('2d');
      const data = {
          labels: nutrientLabels,
          datasets: [{
              label: 'Nutritional Profile',
              data: nutrientValues,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 2
          }]
      };

      const config = {
          type: 'radar',
          data: data,
          options: {
              scales: {
                  r: {
                      angleLines: { display: false },
                      suggestedMin: 0,
                      suggestedMax: 100,
                  }
              }
          }
      };

      new Chart(ctx, config);
  }

  createRadarChart(1);
</script>
{% endblock %}
